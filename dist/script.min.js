const API_URL = "https://pokeapi.co/api/v2/pokemon",
  validatePokemon = (e) =>
    !("object" != typeof e || Array.isArray(e)) &&
    null !== e &&
    ["name", "height", "type"].every((t, o) => t === Object.keys(e)[o]),
  showModal = (e, t, o) => {
    let a = $(".modal-title"),
      l = $(".modal-body");
    $(".modal-header"), a.empty(), l.empty();
    let n = $(`<h1>${e.slice(0, 1).toUpperCase() + e.slice(1)}</h1>`);
    a.append(n),
      Object.keys(t).forEach((e) => {
        l.append(`<p class="modal-details">${e}: ${t[e]}</p>`);
      });
    let i = $(`<img class="modal-img" src=${o} alt=${e}}/>`);
    l.append(i);
  };
let pokemonRepository = (() => {
  let e = [],
    t = function () {
      return e;
    },
    o = () => {
      let e = document.querySelector(".loading"),
        t = document.createElement("p");
      t.classList.add("pokemon-loading"),
        e.appendChild(t),
        (t.innerText = "Loading...");
    },
    a = () => {
      let e = document.querySelector(".pokemon-loading");
      e && e.parentNode.removeChild(e);
    },
    l = (e) => (
      o(),
      fetch(e.detailsUrl)
        .then((e) => e.json())
        .then(
          (t) => (
            a(),
            (e.imageUrl = t.sprites.front_default),
            (e.height = t.height),
            (e.types = t.types),
            e
          )
        )
        .catch((e) => {
          a(), console.log(e);
        })
    ),
    n = (e) => {
      l(e).then(() => {
        let { name: t, imageUrl: o, height: a } = e;
        showModal(t, { height: a }, o);
      });
    },
    i = function (t) {
      validatePokemon(t) && e.push(t);
      let o = document.querySelector(".list-group"),
        a = document.createElement("li");
      a.classList.add("w-25");
      let l = document.createElement("button");
      (l.innerText = t.name),
        l.classList.add("list-group-item", "list-group-item-action", "w-100"),
        $("li").attr("data-toggle", "modal"),
        $("li").attr("data-target", "#exampleModalCenter"),
        a.appendChild(l),
        o.appendChild(a),
        l.addEventListener("click", () => {
          n(t);
        });
    },
    p = () => (
      o(),
      fetch("https://pokeapi.co/api/v2/pokemon")
        .then((e) => (a(), e.json()))
        .then((e) =>
          e.results.forEach((e) => i({ name: e.name, detailsUrl: e.url }))
        )
        .catch((e) => {
          a(), console.log(e);
        })
    ),
    r = function (t) {
      return (
        e.length &&
        e.filter((e) => e.name.toLowerCase().includes(t.toLowerCase()))
      );
    };
  return { getAll: t, addListItem: i, search: r, loadList: p, loadDetails: l };
})();
pokemonRepository
  .loadList()
  .then(() =>
    pokemonRepository.getAll().forEach((e) => pokemonRepository.addListItem(e))
  );
